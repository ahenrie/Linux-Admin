#!/bin/bash

# Check if the script is run as root
if [[ $EUID -ne 0 ]]; then
    echo "This script must be run as root."
    exit 1
fi

# Function to display a menu
function display_menu {
    clear
    echo "############################################"
    echo "#                SHREDDER                  #"
    echo "############################################"
    echo "Choose an operation:"
    echo "[1] Delete all users and their home directories"
    echo "[2] Delete all partitions except the boot drive"
    echo "[3] Delete system logs and files"
    echo "[4] Perform the Trifecta (All of the above)"
    echo "[5] Exit"
    echo "############################################"
}

# Function to delete all users and their home directories
function delete_users {
    echo "Deleting all users except root..."
    for user in $(awk -F: '$3 >= 1000 && $1 != "nobody" {print $1}' /etc/passwd); do
        echo "Deleting user $user..."
        userdel -r "$user"
    done
    echo "All users deleted."
}

# Function to delete partitions on non-boot drives
function delete_partitions {
    echo "Detecting disks..."
    lsblk
    boot_drive=$(df / | tail -1 | awk '{print $1}' | sed 's/[0-9]//g')
    echo "Boot drive detected as $boot_drive"

    for disk in $(lsblk -d -n -o NAME | grep -v "$boot_drive"); do
        echo "Wiping disk /dev/$disk..."
        shred -v -n 3 -z "/dev/$disk"
    done
    echo "All non-boot disks have been shredded."
}

# Function to delete logs and system files
function delete_logs {
    echo "Deleting all logs and system files..."
    find /var/log -type f -exec shred -u {} \;
    echo "Logs deleted."

    echo "Deleting system files..."
    shred -v -n 3 -z /etc /usr /bin /sbin /lib /lib64
    echo "System files deleted."
}

# Function to perform the Trifecta
function perform_trifecta {
    echo "Starting the Trifecta..."
    delete_users
    delete_partitions
    delete_logs
    echo "Trifecta completed."
}

# Main script loop
while true; do
    display_menu
    read -p "Enter your choice [1-5]: " choice

    case $choice in
        1)
            delete_users
            ;;
        2)
            delete_partitions
            ;;
        3)
            delete_logs
            ;;
        4)
            perform_trifecta
            ;;
        5)
            echo "Exiting. Goodbye!"
            exit 0
            ;;
        *)
            echo "Invalid choice. Please try again."
            ;;
    esac
    echo
    read -p "Press [Enter] to return to the menu..." dummy
done
